<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: THREEx | Learning Three.js]]></title>
  <link href="http://learningthreejs.com/blog/categories/threex/atom.xml" rel="self"/>
  <link href="http://learningthreejs.com/"/>
  <updated>2014-01-30T08:26:02+01:00</updated>
  <id>http://learningthreejs.com/</id>
  <author>
    <name><![CDATA[Jerome Etienne]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Lets Make a 3D Game: Make It Embedded]]></title>
    <link href="http://learningthreejs.com/blog/2011/11/21/lets-make-a-3d-game-make-it-embedded/"/>
    <updated>2011-11-21T16:32:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2011/11/21/lets-make-a-3d-game-make-it-embedded</id>
    <content type="html"><![CDATA[<iframe src="http://marblesoccer.com"
    allowfullscreen webkitallowfullscreen mozallowfullscreen
    width="420" height="315" frameborder="0" style="float: right; margin-left: 1em;">
</iframe>


<p>This post is part of the <a href="/blog/categories/tutorial3dgame/">"Let's make a 3D game"</a> series.
The previous post was on
<a href="/blog/2011/11/17/lets-make-a-3d-game-make-it-fullscreen/">fullscreen API</a>.
Here is another one on resizing the display area.
This post is about embedding your game in another page.
It is usefull to include it in a blog, in facebook, iGoogle or other game plateforms.</p>

<p><a href="http://marblesoccer.com">MarbleSoccer</a>
now contains all the tricks explained in this post.
<em>Show dont tell</em>, you can see it embedded on the left.
Embedding your game implies various things.
As your game is hosted in another page, it likely got a smaller display area.
HTML5
<a href="http://www.w3.org/TR/css3-mediaqueries/">CSS media query</a>
makes it easy to fit various sizes.
Another part are the
<a href="http://en.wikipedia.org/wiki/DOM_events">DOM events</a>
from the iframe.
They will be propagated to the host page and may produce undesirable effects.
We see how to shield them.
But first let's see about
<a href="http://en.wikipedia.org/wiki/HTML_element#Frames">iframe</a></p>

<h2>Let's go play in an iframe</h2>

<p><a href="http://en.wikipedia.org/wiki/HTML_element#Frames">iframe</a>
is an easy and secure way to embed a page in another.
Let's declare it.</p>

<p>```html</p>

<pre><code>&lt;iframe src="http://marblesoccer.com"
    allowfullscreen webkitallowfullscreen mozallowfullscreen
    width="480" height="320" frameborder="0"&gt;
&lt;/iframe&gt;
</code></pre>

<p>```</p>

<!-- more -->


<p>The attributes are pretty classics: <code>frameborder</code> to remove an ugly default border,
 <code>width</code> and <code>height</code> for size and <code>src</code> for your game page.
The ones ending with <code>allowfullscreen</code> tell the browser that this iframe is
allowed to go fullscreen. More about fullscreen in this
<a href="/blog/2011/11/17/lets-make-a-3d-game-make-it-fullscreen/">previous post</a>
or in the <a href="http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html">spec</a>.</p>

<p>You may need to determined if your game is embedded or not.
Use this line will tell if it is in a iframe or not.</p>

<p>```javascript</p>

<pre><code>var isInIframe  = (window != window.top);
</code></pre>

<p>```</p>

<h2>Fit in a smaller display area</h2>

<p>When your game is embedded, it is likely to have a smaller display area.
How to deal with this ?
First, we have 2 types of rendering in our game:
a 3D display where
<a href="https://github.com/mrdoob/three.js/">three.js</a>
displays the
<a href="http://en.wikipedia.org/wiki/WebGL">WebGL</a>, and
a DOM display for
<a href="http://en.wikipedia.org/wiki/On-screen_display">OSD</a>
such as score, timers and other popups.</p>

<p>For <em>3D rendering</em>, we have already seen window resizing in
<a href="/blog/2011/08/30/window-resize-for-your-demos/">this post</a>.
Just download
<a href="/data/THREEx/THREEx.WindowResize.js">THREEx.WindowResize</a>
and add this line and you are done. Not too hard, hey.</p>

<p>```javascript</p>

<pre><code>THREEx.WindowResize(renderer, camera);
</code></pre>

<p>```</p>

<p>Now <em>the DOM display</em>. It may simply be done via CSS
and
<a href="http://www.w3.org/TR/css3-mediaqueries/">media queries</a>.
Typically, you may reduce the size of your font or icons.
I won't try to teach css, other do that much
<a href="https://developer.mozilla.org/en/CSS/Media_queries">better</a>
<a href="http://www.html5rocks.com/en/mobile/mobifying.html#toc-mediaqueries">than</a>
<a href="http://thinkvitamin.com/code/media-queries-width-and-height-video-tutorial/">me</a>.
Just a pick of what i did, not sure at all it is the best way.
I reduce the OSD display if your game page is 640px or less.</p>

<p>```css</p>

<pre><code>@media all and (max-width: 640px) {
    /* here put your style specific for embedded case */
    body { font-size : 60%; }
    img { width : 48px; }
}
</code></pre>

<p>```</p>

<h2>Shield Events</h2>

<p>Strange section title, hey.
It means <em>prevents DOM events from the iframe to interfere with the host page</em>.
Not much clearer...
Maybe with an example ? Let's see the arrows+scroll case.
Show dont tell.
Below are 2 iframes: on the left, no shielding happens, on the right shielding happens.
Try to click on them and use arrows up/down.</p>

<iframe src="http://learningthreejs.com/data/THREEx/examples/threex.embedded/noshield-iframe.html" width='50%' height='120px'></iframe>


<iframe src="http://learningthreejs.com/data/THREEx/examples/threex.embedded/withshield-iframe.html" width='49%' height='120px'></iframe>


<p>On the left, the host page scrolls, but not on the right.
Why does this happen ? good question :)
If our game iframe got the focus and users press up or down, the iframe will received
<a href="http://www.quirksmode.org/dom/events/keys.html">keydown/keyup events</a>.
Up to now, all is ok...
Troubles appear when those events are bubbling to the host page, they may trigger a scrolling.</p>

<p>Imagine the page going up and down while you play, the game becomes unplayable very fast :)
So here is the code which prevents this behavior. It listens to arrows
<a href="http://www.quirksmode.org/dom/events/keys.html">keydown events</a>.
and prevent their default.</p>

<p>```javascript</p>

<pre><code>document.addEventListener('keydown', function(event){
    // if it is keydown on a arrow, prevent default
    if( event.keyCode &gt;= 37 &amp;&amp; event.keyCode &lt;= 40 ){
        event.preventDefault();
    }
}, true);
</code></pre>

<p>```</p>

<h2>Conclusion</h2>

<p>I gathered the code in
<a href="/data/THREEx/threex.embedded.js">threex.embedded</a>,
see its
<a href="/data/THREEx/docs/threex.embedded.html">annoted source</a>.
Iframe is a easy and secure way to make your game embeddable.
We have seen how to handle smaller display area
with
<a href="/data/THREEx/THREEx.WindowResize.js">THREEx.WindowResize</a>
and
<a href="http://www.w3.org/TR/css3-mediaqueries/">media queries</a>.
Additionnaly we even shield DOM events, so we can use arrow keys for player control.
You are all set! Go embed your game now :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Lets Make a 3D Game: Make It Fullscreen]]></title>
    <link href="http://learningthreejs.com/blog/2011/11/17/lets-make-a-3d-game-make-it-fullscreen/"/>
    <updated>2011-11-17T07:59:00+01:00</updated>
    <id>http://learningthreejs.com/blog/2011/11/17/lets-make-a-3d-game-make-it-fullscreen</id>
    <content type="html"><![CDATA[<p>This post is part of the <a href="/blog/categories/tutorial3dgame/">"Lets make a 3D game"</a> series.
It is about the <a href="http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html">fullscreen API</a>.
This API allows to make DOM elements fullscreen.
Fullscreen is quite important for games.
It provides a larger display so a more immersive experience for your players.
All that from javascript, so no more needed to ask "please f11" to your
players, isnt that sweet ? :)</p>

<p><img class="right" src="/data/lets-make-a-3d-game-make-it-fullscreen/images/fullscreen-icon.png"></p>

<p>The <a href="http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html">fullscreen API</a>
is still in discussion, but the basics are settled. At the time of this writing,
it is available in
<a href="http://blog.pearce.org.nz/2011/11/firefoxs-html-full-screen-api-enabled.html">firefox nightly</a>,
<a href="http://peter.sh/2011/01/javascript-full-screen-api-navigation-timing-and-repeating-css-gradients/">webkit nightly</a>and
<a href="http://updates.html5rocks.com/2011/10/Let-Your-Content-Do-the-Talking-Fullscreen-API">chrome stable</a>.
It has been already added in <a href="http://marblesoccer.com">marbleSoccer</a>.
The icon is from <a href="http://thenounproject.com/">The Noun Project</a>, a source of nice and clean icons.
Try it out! Click on it to toggle fullscreen state. If you dont see the icon, your browser
doesn't yet have the fullscreen API.</p>

<center>
    <iframe webkitallowfullscreen mozallowfullscreen allowfullscreen width="100%" height="320" src="http://marblesoccer.com" frameborder="0"></iframe>
</center>


<p>Ok now is time for code :)</p>

<h2>Let's get started</h2>

<p>As usual, i provide a little helper to make it easier for you to include it in
your games. It is called <a href="/data/THREEx/THREEx.FullScreen.js">THREEx.FullScreen.js</a>.
It hides the prefix of each vendor and the little discrepencies between their API
implementation.
You download this file from <a href="/data/THREEx/THREEx.FullScreen.js">here</a> and include
it in your page like this</p>

<p>```html</p>

<pre><code>&lt;script src='THREEx.FullScreen.js'&gt;&lt;/script&gt;
</code></pre>

<p>```</p>

<!-- more -->


<h2>How to use it ?</h2>

<p>The API is simple, only 4 calls. Lets see them one by one.
To test if it is possible to have fullscreen on your system, do</p>

<p>```javascript</p>

<pre><code>THREEx.FullScreen.available();
</code></pre>

<p>```</p>

<p>To test if fullscreen is currently activated on your page</p>

<p>```javascript</p>

<pre><code>THREEx.FullScreen.activated();
</code></pre>

<p>```</p>

<p>To Request fullscreen on a given element, just do</p>

<p>```javascript</p>

<pre><code>THREEx.FullScreen.request(element);
</code></pre>

<p>```</p>

<p>If element isnt provided, it defaults to <code>document.body</code>.
To cancel fullscreen on your page, use this line.</p>

<p>```javascript</p>

<pre><code>THREEx.FullScreen.cancel();
</code></pre>

<p>```</p>

<p>Quite straight forward, no ? :) As an example, let's make a toggle, the same used
in <a href="http://marblesoccer.com">marbleSoccer</a>.</p>

<p>```javascript</p>

<pre><code>if( THREEx.FullScreen.activated() ){
    THREEx.FullScreen.cancel();
}else{
    THREEx.FullScreen.request();
}
</code></pre>

<p>```</p>

<h2>What about the standard ?</h2>

<p>There is a <a href="http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html">w3c proposal</a> in dicussion.
John dyer has written an in-depth <a href="http://johndyer.name/native-fullscreen-javascript-api-plus-jquery-plugin/">summary</a>.
Mozilla provides details on <a href="https://wiki.mozilla.org/Gecko:FullScreenAPI">their API</a>.
At the time of this writing
It is available in
<a href="http://blog.pearce.org.nz/2011/11/firefoxs-html-full-screen-api-enabled.html">firefox nightly</a>,
<a href="http://peter.sh/2011/01/javascript-full-screen-api-navigation-timing-and-repeating-css-gradients/">webkit nightly</a>
and
<a href="http://updates.html5rocks.com/2011/10/Let-Your-Content-Do-the-Talking-Fullscreen-API">chrome stable</a>.</p>

<h2>Conclusion</h2>

<p>For more details on <a href="/data/THREEx/THREEx.FullScreen.js">THREEx.FullScreen</a>,
see its <a href="/data/THREEx/docs/THREEx.FullScreen.html">annoted source</a>.
It is a simple to add in your game.
It provides a more immersive experience to your players.
On a related subject, we will soon likely do a post about embedding your game in another page.
It is usefull when you want to include it in a blog, in facebook or other game plateforms.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Screenshot in Javascript]]></title>
    <link href="http://learningthreejs.com/blog/2011/09/03/screenshot-in-javascript/"/>
    <updated>2011-09-03T10:01:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2011/09/03/screenshot-in-javascript</id>
    <content type="html"><![CDATA[<p>Sometime it would be cool if you could take a screenshot of your demo to share with your friends.
This post will explain how to do that single a single line.
Additionnaly, <a href="/data/THREEx/THREEx.screenshot.js">THREEx.screenshot</a> helper is provided at the end
if you want to add printscreen key in your demos without hasles.</p>

<h2>Let's get started</h2>

<p>So as usual you got a <code>renderer</code> variable to render your 3D scene. This renderer
contains a <code>domElement</code> property.
It is a <a href="http://en.wikipedia.org/wiki/Document_Object_Model">DOM element</a> on which it renders,
who would have guessed ?
We will use the <code>.toDataURL()</code>
<a href="http://www.w3.org/TR/html5/the-canvas-element.html#dom-canvas-todataurl">method</a>
on this element to get the screenshot.</p>

<p>```javascript</p>

<pre><code>var dataUrl = renderer.domElement.toDataURL("image/png");
</code></pre>

<p>```</p>

<!-- more -->


<p>A single line and you are <strong>done</strong>! not too hard hey ?
This line will return a url of the screenshot image in
png format.
This url is a <a href="http://en.wikipedia.org/wiki/Data_URI_scheme">data url</a>, a special url which encode
the content in base64. It looks like that <em>data:image/png;base64,iVBORw0KGgo</em> ...
Not too readable but quite usefull :)</p>

<p>Btw have you spotted he <code>image/png</code> parameter ? It is the mimetype of the image we will get. If you want
a <a href="http://en.wikipedia.org/wiki/JPEG">jpeg</a>, just put <code>image/jpeg</code> instead.</p>

<h2>WebGLRenderer special case</h2>

<p>If your scene is renderered with WebGL, you should declare it like that.</p>

<p>```javascript</p>

<pre><code>var renderer    = new THREE.WebGLRenderer({
    preserveDrawingBuffer   : true  // required to support .toDataURL()
});
</code></pre>

<p>```</p>

<p>Notice the option <code>preserveDrawingBuffer</code> ? It is <code>WebGLRenderer</code> specific.
This is required to support <code>.toDataURL()</code> as explained in the <a href="http://www.khronos.org/registry/webgl/specs/latest/#2.2">spec</a>.
Other <a href="https://github.com/mrdoob/three.js/tree/master/src/renderers">renderers</a> dont need it.</p>

<h2>THREEx helper to make it even simpler</h2>

<p>I wrote <a href="/data/THREEx/THREEx.screenshot.js">THREEx.screenshot</a>, a THREEx helper to
automatize the process and makes it as simple as possible.
You download it from <a href="/data/THREEx/THREEx.screenshot.js">here</a> and include
it in your page like this</p>

<p>```html</p>

<pre><code>&lt;script type="text/javascript" src="THREEx.screenshot.js"&gt;&lt;/script&gt;
</code></pre>

<p>```</p>

<p>Would it be cool if got your own <a href="http://en.wikipedia.org/wiki/Print_screen">printscreen</a>
key for your 3D ? The following line will do exactly that.
Everytime you press <em>p</em>, it does a screenshot of the renderer, and open a window containing it.</p>

<p>```javascript</p>

<pre><code>THREEx.Screenshot.bindKey(renderer);
</code></pre>

<p>```</p>

<p>Note the <a href="http://en.wikipedia.org/wiki/Aspect_ratio_(image)">aspect</a> of the original image is preserved.
The default callback behavior is to open a window containing the screenshot, so be carefull it may be
stopped by popup blockers.
It is possible to customize the default behaviors thru options.
For more details, see the <a href="/data/THREEx/docs/THREEx.screenshot.html">annoted source</a> of
<a href="/data/THREEx/THREEx.screenshot.js">THREEx.screenshot</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Window Resize For Your Demos]]></title>
    <link href="http://learningthreejs.com/blog/2011/08/30/window-resize-for-your-demos/"/>
    <updated>2011-08-30T11:24:00+02:00</updated>
    <id>http://learningthreejs.com/blog/2011/08/30/window-resize-for-your-demos</id>
    <content type="html"><![CDATA[<p>It is cool when you look at a demo and it is resized automatically
when you change the dimension of the browser's window. To switch it fullscreen
or such.
<a href="/data/THREEx/THREEx.WindowResize.js">THREEx.WindowResize</a> is an little piece of code.
It helps you do exactly that on your own demos in a single line.</p>

<h2>Let's include the script</h2>

<p>You download it from <a href="/data/THREEx/THREEx.WindowResize.js">here</a> and include
it in your page like this</p>

<p>```html</p>

<pre><code>&lt;script src='THREEx.WindowResize.js'&gt;&lt;/script&gt;
</code></pre>

<p>```</p>

<!-- more -->


<h2>Let's use it</h2>

<p>Now that the script is included, simply call the following line, and you are done!
Your renderer will follow the window size.</p>

<p>```javascript</p>

<pre><code>THREEx.WindowResize(renderer, camera);
</code></pre>

<p>```</p>

<p>As usual you got a <code>renderer</code> and a <code>camera</code> variable, just pass
them to the function and they will be updated on window resize.</p>

<h2>Conclusion</h2>

<p>For more details, see the <a href="/data/THREEx/docs/THREEx.WindowResize.html">annoted source</a> of
<a href="/data/THREEx/THREEx.WindowResize.js">THREEx.WindowResize</a>.</p>
]]></content>
  </entry>
  
</feed>

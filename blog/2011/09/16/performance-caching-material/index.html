
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Performance: Caching Material - Learning Three.js</title>
  <meta name="author" content="Jerome Etienne">

  
  <meta name="description" content="This article is about performance and how caching can improve them.
In WebGL, it is important not to push the same textures multiple times to the GPU &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://learningthreejs.com/blog/2011/09/16/performance-caching-material/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/LearningThreejs" rel="alternate" title="Learning Three.js" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4037844-19']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
	<style>
		#linksPerso {
			float	: right;
			height	: 128px;
		}
		#linksPerso .wrapper {
			height	: 128px;
			overflow-y:hidden;

		}
		#linksPerso img {
			width	: 128px;
		}
	</style>
	<div id='linksPerso' style='display: block;'>
		<a href='mailto:jerome.etienne@gmail.com?Subject=query%20from%20learningthreejs' target='_blank'>
			<img src='/data/images/jetienne-hire-me-256x256.png'/>
		</a>
	</div>

  <h1><a href="/">Learning Three.js</a></h1>
  
    <h2>or WebGL for Dummies</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/LearningThreejs" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:learningthreejs.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://jeromeetienne.github.io/videobrowser4learningthreejs/">Videos</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Performance: Caching Material</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-16T10:25:00+01:00" pubdate data-updated="true">Sep 16<span>th</span>, 2011</time>
        
        
          <div class="sharing" style='text-align: right;'>
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://learningthreejs.com/blog/2011/09/16/performance-caching-material/" data-via="LearningThreejs" data-counturl="http://learningthreejs.com/blog/2011/09/16/performance-caching-material/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

        
     </p>
    
  </header>


<div class="entry-content"><p>This article is about performance and how caching can improve them.
In WebGL, it is important not to push the same textures multiple times to the GPU.
It uselessly slow down the rendering.
As a rules of thumbs, the less data are exchanged between the cpu and the gpu, the better
it is for performance.</p>

<h2>A Basic Caching</h2>

<p><a href="https://github.com/mrdoob/three.js/">three.js</a> handles cache cleanly and
eleguantly. If you instanciate
a javascript object
<a href="https://github.com/mrdoob/three.js/blob/master/src/textures/Texture.js">THREE.texture</a>
or
a <a href="https://github.com/mrdoob/three.js/blob/master/src/materials/Material.js">THREE.Material</a>
only once, it will be pushed only once to the GPU.
It is the simplest way to avoid pushing them multiple times.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span><span class="nx">map</span><span class="o">:</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">ImageUtils</span><span class="p">.</span><span class="nx">loadTexture</span><span class="p">(</span> <span class="s1">&#39;foo.jpg&#39;</span><span class="p">)});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you use this material as many times as you want, <code>foo.jpg</code> will be sent
only once to the GPU. For example, let&#8217;s create many
<a href="https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/SphereGeometry.js">spheres</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span> <span class="p">),</span> <span class="nx">material</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This solution is simple and eleguant but may not be practical with a large code,
like a <a href="/blog/categories/tutorial3dgame/">game</a>.
In such case, you can use <a href="https://github.com/jeromeetienne/MicroCache.js">microcache.js</a>.
It is a micro library to handle in-memory cache which works in node and browser.</p>

<!-- more -->


<h2>So Let&#8217;s Cache with microcache.js</h2>

<p>It needs only 3 lines. To install <a href="https://github.com/jeromeetienne/MicroCache.js">microcache.js</a>,
download it and copy this line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;microcache.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>To instanciate a cache, use the following line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">renderer</span><span class="p">.</span><span class="nx">_microCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MicroCache</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you likely noticed, it is attaching the cache to the renderer.
Why do we do that ?
First, it is required to support multiple renderers on the same page, each with it own cache.
Additionnaly if you stop using a renderer, the cache will be automatically dropped
by javascript <a href="http://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">garbage collector</a>.
Two nice features.
Now lets create a texture and cache it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">_microCache</span><span class="p">.</span><span class="nx">getSet</span><span class="p">(</span><span class="s1">&#39;heavy&#39;</span><span class="p">,</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ImageUtils</span><span class="p">.</span><span class="nx">loadTexture</span><span class="p">(</span><span class="s1">&#39;foo.png&#39;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is it. It is <em>as simple as that</em>.
Now maybe you wonder &#8220;yeah but how do i know what need to be cached&#8221;&#8230;
I completly agree, it is always nice to get diagnostics from the system when
optimizing performance.</p>

<h2>Now Let&#8217;s Diagnose</h2>

<p><img class="right" src="/data/performance-tip-caching-material/webgl-inspector-texture.png" title="Example" ></p>

<p>You can check what is pushed to the GPU with
<a href="http://benvanik.github.com/WebGL-Inspector/">WebGL inspector</a>.
It is a firebug-like to &#8220;debug, diagnose, and explore WebGL scenes&#8221;.
You can see the texture tabs on the right. If you spot
duplicates in there, you found rooms for optimization :)
You can embed it in your own page application with a single line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://raw.github.com/benvanik/WebGL-Inspector/master/core/embed.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>That&#8217;s All Folks</h2>

<p>As Terje Mathisen said, &#8220;All programming is an exercise in caching.&#8221;
Caching is a efficient way to optimize your code.
It is simple with <a href="https://github.com/jeromeetienne/MicroCache.js">microcache.js</a>.
The code is available on github <a href="https://github.com/jeromeetienne/MicroCache.js">here</a> under MIT license.
If you hit bugs, fill issues on github. Feel free to fork, modify and have fun with it :)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jerome Etienne</span></span>

      








  


<time datetime="2011-09-16T10:25:00+01:00" pubdate data-updated="true">Sep 16<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/performance/'>performance</a>, <a class='category' href='/blog/categories/three-dot-js/'>three.js</a>
  
</span>


    </p>
    
      <div class="sharing" style='text-align: right;'>
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://learningthreejs.com/blog/2011/09/16/performance-caching-material/" data-via="LearningThreejs" data-counturl="http://learningthreejs.com/blog/2011/09/16/performance-caching-material/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/09/14/lets-make-a-3D-game-map-editor/" title="Previous Post: Let's Make a 3D Game: Map Editor">&laquo; Let's Make a 3D Game: Map Editor</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/09/20/lets-make-a-3D-game-device-orientation/" title="Next Post: Let's Make a 3D Game: Device Orientation">Let's Make a 3D Game: Device Orientation &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/30/three-dot-js-inspector-in-chrome-devtools/">Three.js Inspector in Chrome Devtools</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/24/learningthree-dot-js-news-number-10-stay-tuned-with-creative-3d-demos/">LearningThree.js News #10: Stay Tuned With Creative 3D Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/17/learningthree-dot-js-news-number-9-stay-tuned-with-creative-3d-demos/">LearningThree.js News # 9: Stay Tuned With Creative 3D Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/16/hatsune-miku-dancing-in-augmented-reality/">Hatsune Miku Dancing In Augmented Reality</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/10/learningthree-dot-js-news-number-8-stay-tuned-with-creative-3d-demos/">LearningThree.js News #8: Stay Tuned With Creative 3D Demos</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("LearningThreejs", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/LearningThreejs" class="twitter-follow-button" data-show-count="false">Follow @LearningThreejs</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jerome Etienne -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'learningthreejs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://learningthreejs.com/blog/2011/09/16/performance-caching-material/';
        var disqus_url = 'http://learningthreejs.com/blog/2011/09/16/performance-caching-material/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

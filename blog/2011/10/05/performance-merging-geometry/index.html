
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Performance: Merging Geometry - Learning Three.js</title>
  <meta name="author" content="Jerome Etienne">

  
  <meta name="description" content="This article is about merging geometry and how it can improve performance.
It is important for perfomance to reduce the number of WebGL calls as much &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/LearningThreejs" rel="alternate" title="Learning Three.js" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4037844-19']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
	<style>
		#linksPerso {
			float	: right;
			height	: 128px;
		}
		#linksPerso .wrapper {
			height	: 128px;
			overflow-y:hidden;

		}
		#linksPerso img {
			width	: 128px;
		}
	</style>
	<div id='linksPerso' style='display: block;'>
		<a href='mailto:jerome.etienne@gmail.com?Subject=query%20from%20learningthreejs' target='_blank'>
			<img src='/data/images/jetienne-hire-me-256x256.png'/>
		</a>
	</div>

  <h1><a href="/">Learning Three.js</a></h1>
  
    <h2>or WebGL for Dummies</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/LearningThreejs" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:learningthreejs.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://jeromeetienne.github.io/videobrowser4learningthreejs/">Videos</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Performance: Merging Geometry</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-05T11:29:00+01:00" pubdate data-updated="true">Oct 5<span>th</span>, 2011</time>
        
        
          <div class="sharing" style='text-align: right;'>
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/" data-via="LearningThreejs" data-counturl="http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

        
     </p>
    
  </header>


<div class="entry-content"><p>This article is about merging geometry and how it can improve performance.
It is important for perfomance to reduce the number of <a href="http://www.khronos.org/registry/webgl/specs/latest/">WebGL</a> calls as much as possible.
The rules of thumbs is <em>the less data are exchanged between the cpu and the gpu, the better it is for performance</em>.</p>

<p>The <a href="/data/performance-merging-geometry/">demo</a> is rendering many cubes and put them randomly in the space.
<img class="left" src="/data/performance-merging-geometry/images/demo-screenshot-2000.png" width="240" height="120">
<img class="right" src="/data/performance-merging-geometry/images/demo-screenshot-120000.png" width="240" height="120">
It is a simplictic way to measure the performance, but it will do for us.
If the geometries arent merged, my computer is able to display <em>2000</em> cubes at 30fps. See on the left.
But if the geometry are merged, it displays <em>120000</em> cubes at 30fps. See on the right.
Screenshots make it pretty obvious :) This is <strong>60 times</strong> more cubes!!!</p>

<!-- more -->


<h2>So Let&#8217;s Merge Geometries</h2>

<p>A geometry is the shape of the 3D object. three.js got already
<a href="https://github.com/mrdoob/three.js/tree/master/src/extras/geometries">several predefined</a> for you.
<a href="https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/PlaneGeometry.js">plane</a>,
<a href="https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/CubeGeometry.js">cube</a> or
<a href="https://github.com/mrdoob/three.js/blob/master/src/extras/geometries/SphereGeometry.js">sphere</a>
are the common ones.
This post is about merging them, so lets do that.
This line will merge <code>otherGeometry</code> into <code>geometry</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">THREE</span><span class="p">.</span><span class="nx">GeometryUtils</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">geometry</span><span class="p">,</span> <span class="nx">otherGeometry</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>THREE.GeometryUtils.merge()</code> is in <a href="https://github.com/mrdoob/three.js/blob/master/src/extras/GeometryUtils.js">THREE.GeometryUtils</a> with other geometry related functions.
Btw it is more a concatenation than an actual merge them. No duplicate is removed in the process.</p>

<h2>Combo: merging geometry with mesh</h2>

<p> <code>THREE.GeometryUtils.merge()</code> supports to merge geometries with meshes too.
In this case, the function will honor the mesh position/orientation.
As a bonus, if your mesh uses <code>THREE.MeshFaceMaterial</code>, materials will be copied along.
It is quite convenient when building a large geometry, or when optimising existing scenes with meshes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">CubeGeometry</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshNormalMaterial</span><span class="p">());</span>
</span><span class='line'><span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'><span class="nx">mesh</span><span class="p">.</span><span class="nx">rotation</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="nx">THREE</span><span class="p">.</span><span class="nx">GeometryUtils</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">geometry</span><span class="p">,</span> <span class="nx">mesh</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will merge a <code>THREE.CubeGeometry</code> with a translation of <code>30</code> on <code>x</code>
and a rotation of <code>Math.PI/3</code> on <code>y</code>.
Simple enougth hey ? what about Limitations ?</p>

<h2>When to use it ?</h2>

<p>The answer is <em>whenever possible</em> due to the performance improvement.
The merged geometry will act as a single atomic shape.
So it is perfect with static geometry.
But it may not be suitable in all cases.
For example, it won&#8217;t be possible to move the merged objects independantly from each other.
Or you can no more remove or add a object without recomputing the whole geometry.</p>

<h2>Conclusion</h2>

<p>So merging geometry reduces the amount of webgl calls, so dramatically improve
performance (x60 time in our little demo). It is simple enougth to add to your
demos or games when they have large static geometries. So use it as much as possible.
That&#8217;s all folks. I hope it has been usefull :)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jerome Etienne</span></span>

      








  


<time datetime="2011-10-05T11:29:00+01:00" pubdate data-updated="true">Oct 5<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/performance/'>performance</a>, <a class='category' href='/blog/categories/three-dot-js/'>three.js</a>
  
</span>


    </p>
    
      <div class="sharing" style='text-align: right;'>
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/" data-via="LearningThreejs" data-counturl="http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/09/20/lets-make-a-3D-game-device-orientation/" title="Previous Post: Let's Make a 3D Game: Device Orientation">&laquo; Let's Make a 3D Game: Device Orientation</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/10/17/lets-make-a-3d-game-microphysics-js/" title="Next Post: Lets Make a 3D Game: microphysics.js">Lets Make a 3D Game: microphysics.js &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/16/hatsune-miku-dancing-in-augmented-reality/">Hatsune Miku Dancing In Augmented Reality</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/10/learningthree-dot-js-news-number-8-stay-tuned-with-creative-3d-demos/">LearningThree.js News #8: Stay Tuned With Creative 3D Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/03/learningthree-dot-js-news-number-7-stay-tuned-with-creative-3d-demos/">LearningThree.js News #7: Stay Tuned with Creative 3D Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/29/learningthree-dot-js-news-number-6-stay-tuned-with-creative-3d-demos/">LearningThree.js News #6: Stay Tuned with Creative 3D Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/18/learningthree-dot-js-news-number-5-stay-tuned-with-creative-3d-demos/">LearningThree.js News #5: Stay Tuned with Creative 3D Demos</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("LearningThreejs", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/LearningThreejs" class="twitter-follow-button" data-show-count="false">Follow @LearningThreejs</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jerome Etienne -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'learningthreejs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/';
        var disqus_url = 'http://learningthreejs.com/blog/2011/10/05/performance-merging-geometry/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
